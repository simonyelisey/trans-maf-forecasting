# trans-maf-forecasting

## Описание задачи

Прогнозирование многомерных временных рядов с помощью условных нормализующих потоков [Trans-MAF](https://arxiv.org/pdf/2002.06103.pdf). 

В ходе исследования проводятся следующие эксперименты:
  - прогнозирование регулярных временных рядов с использованием модели Trans-MAF;
  - сравнение Trans-MAF с диффузионной моделью для прогнозирования временных рядов [TimeGrad](https://arxiv.org/abs/2305.00624.pdf);
  - прогнозирование нерегулярных временных рядов с долей пропусков в данных от 10% до 80%.

## Структуры репозитория
```
trans-maf-forecasting
|
|--- reports
|      |
|      | -- MetricsComparison__run_00.ipynb             # сравнение прогнозов Trans-MAF и TimeGrad на регулярных временных рядах
|      |
|      | -- MetricsComparison__run_02.ipynb             # анализ прогнозов Trans-MAF на нерегулярных временных рядах
|
| --- time_grad
|      |
|      | --- notebooks
|      |       |
|      |       | --- timegrad_run_00.ipynb             # обучение и прогнозирование регулярных временных рядов TimeGrad
|      |
|      | --- requirements.txt                          # зависимости для успешного запуска TimeGrad
|
| --- trans_maf
|      |
|      | --- notebooks
|      |       |
|      |       | --- maf_run_00.ipynb                  # обучение и прогнозирование регулярных временных рядов Trans-MAF
|      |       |
|      |       | --- maf_run_01.ipynb                  # прогнозирование датасета Exchange в сокрощеннов виде (последние 4 года, вместо всей истории)
|      |       |
|      |       | --- maf_run_02.ipynb                  # обучение и прогнозирование нерегулярных временных рядов Trans-MAF
|      |       |
|      |
|      | --- requirements.txt                          # зависимости для успешного запуска Trans-MAF
|
| --- README.md                                        # описание проекта
```

## Данные

Используются датасеты из открытых источников:

1. Solar:
   - гранулярность: H;
   - число компонент: 137;
   - обучающая выборка: 2006-01-01 00:00:00 - 2006-10-20 00:00:00 (7033 точки);
   - тестовая выборка: 2006-10-20 01:00:00 - 2006-10-27 00:00:00 (168 точек);
   - длина прогноза: 24.
3. Electricity:
   - гранулярность: H;
   - число компонент: 370;
   - обучающая выборка: 2014-03-19 09:00 - 2014-09-01 00:00 (4000 точки);
   - тестовая выборка: 2014-09-01 01:00 - 2014-09-08 00:00:00 (168 точек);
   - длина прогноза: 24.
5. Exchange:
   - гранулярность: B;
   - число компонент: 8;
   - обучающая выборка: 1990-01-01 - 2013-04-08 (6101 точки);
   - тестовая выборка: 2013-04-09 - 2013-11-04 (150 точек);
   - длина прогноза: 30.
  
## Результаты экспериментов
### Сравнение Trans-MAF и TimeGrad
   
1.1 $MAPE$ 
   
| Dataset    | Trans-MAF | TimeGrad |
| --------- | --------- | --------
| Solar      | 4.45  | 5.88
| Electricity|   0.18 | 0.16
| Exchange   |   6.16 | 0.02

1.2 $RMSE$ 
   
| Dataset    | Trans-MAF | TimeGrad |
| --------- | --------- | --------
| Solar      | 32.88  | 30.44
| Electricity|   683.92 | 774.69
| Exchange   |   0.39 | 0.03

1.2 $CRPS_{sum}$
   
| Dataset    | Trans-MAF | TimeGrad |
| --------- | --------- | --------
| Solar      | 0.37  | 0.38
| Electricity|   0.04 | 0.03
| Exchange   |   0.38 | 0.008

### Прогнозирование нерегулярных временных рядов Trans-MAF
   
1.1 $MAPE$ 
   
| Dataset    | Date features | $p\in(0, 0.1)$ |$p\in(0.3, 0.4)$|$p\in(0.6, 0.7)$|
| --------- | ---------     | --------        |---------------|----------------
| Solar      | 1            | 5.08            |3.98               |5.16
|            |  0           | 3.52            |3.34               |2.88
| Electricity|   1          | 0.16            |0.33               |0.59
|            |    0         | 0.19            |0.35               |0.60
| Exchange   |   1          | 6.38            |6.17               |6.17
|            |   0          | 6.25            |6.15               |6.04

1.2 $RMSE$ 
   
| Dataset    | Date features | $p\in(0, 0.1)$ |$p\in(0.3, 0.4)$|$p\in(0.6, 0.7)$|
| --------- | ---------     | --------        |---------------|----------------
| Solar      | 1            | 34.00            |36.90               |	2723.79
|            |  0           | 32.21            |35.64               |51.66
| Electricity|   1          | 635.13            |2082.33               |3220.51
|            |    0         | 1047.26            |3179.54               |3253.26
| Exchange   |   1          | 0.45            |0.34               |0.37
|            |   0          | 0.36            |0.27               |0.34

1.2 $CRPS_{sum}$
   
| Dataset    | Date features | $p\in(0, 0.1)$ |$p\in(0.3, 0.4)$|$p\in(0.6, 0.7)$|
| --------- | ---------     | --------        |---------------|----------------
| Solar      | 1            | 0.38            |0.43               |0.57
|            |  0           | 0.35            |0.40               |0.72
| Electricity|   1          | 0.03            |0.28               |0.50
|            |    0         | 0.09            |0.27               |0.50
| Exchange   |   1          | 0.46            |0.16               |0.10
|            |   0          | 0.35            |0.13               |0.08

, где $p$ - доля пропусков в рядах.

## Итоговый продукт

Итоговым продуктом является библиотека на языке Python для прогноза многомерных рядов с помощью модели Trans-MAF.

## План работы
1. [2024-02-29] - Завершение всех экспериментов;
2. [2024-03-14] - Создание библиотеки;
3. [2024-04-31] - Завершение оформления статьи.
   
## Контакты

**Автор работы**: Елисеев Семен, студент НИУ ВШЭ, tg: @simonyelisey;

**Научный руководитель**: Гущин Михаил, старший научный сотрудник НИУ ВШЭ, tg: @mikhail_h91
